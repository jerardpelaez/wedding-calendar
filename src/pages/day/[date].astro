---
import CalendarLayout from '@/layouts/CalendarLayout.astro'
import TheNavbar from '@/components/vue/layout/TheNavbar.vue'
import EventList from '@/components/vue/events/EventList.vue'
import PhotoGallery from '@/components/vue/photos/PhotoGallery.vue'
import { months, YEAR } from '@/data/months'

export function getStaticPaths() {
  const paths = []
  for (const month of months) {
    for (let day = 1; day <= month.daysInMonth; day++) {
      const dateStr = `${YEAR}-${String(month.number).padStart(2, '0')}-${String(day).padStart(2, '0')}`
      paths.push({
        params: { date: dateStr },
        props: { date: dateStr, month: month.number, monthName: month.name, day },
      })
    }
  }
  return paths
}

const { date, month, monthName, day } = Astro.props
const base = import.meta.env.BASE_URL.replace(/\/$/, '')

function adjacentDate(dateStr: string, offset: number): string | undefined {
  const d = new Date(`${dateStr}T12:00:00`)
  d.setDate(d.getDate() + offset)
  if (d.getFullYear() !== YEAR) return undefined
  const y = d.getFullYear()
  const m = String(d.getMonth() + 1).padStart(2, '0')
  const dd = String(d.getDate()).padStart(2, '0')
  return `${y}-${m}-${dd}`
}

const prevDate = adjacentDate(date, -1)
const nextDate = adjacentDate(date, 1)
const prevHref = prevDate ? `${base}/day/${prevDate}` : undefined
const nextHref = nextDate ? `${base}/day/${nextDate}` : undefined

const displayDate = new Date(`${date}T00:00:00`).toLocaleDateString('en-US', {
  weekday: 'long',
  year: 'numeric',
  month: 'long',
  day: 'numeric',
})
---

<CalendarLayout
  title={`${displayDate} â€” Wedding Calendar`}
  heading={displayDate}
  backHref={`${base}/month/${month}`}
  backLabel={monthName}
  prevHref={prevHref}
  nextHref={nextHref}
>
  <TheNavbar client:only="vue" slot="navbar" />

  <div class="space-y-8">
    <EventList client:load date={date} />
    <PhotoGallery client:only="vue" date={date} />
  </div>
</CalendarLayout>
